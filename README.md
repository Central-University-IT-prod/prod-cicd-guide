# Гайд по настройке Github Actions в проекте

Небольшой гайдлайн по настройке CI/CD в Ваших проектах.

По всем вопросам в TG - @akrbout.

## Этап 1 - Устанавливаем раннеры на виртуальные машины

Все пайплайны будут исполняться удаленно, на Ваших виртуальных машинах. Содержимое проекта клонится на диск машины, после чего выполняются действия, описанные в пайплайне.

Заходим в настройки проекта, в пункт Runners. Нажимаем на кнопку "New self-hosted runner".

![github runner creation](/static/img/runner-creation-first.png)

Видим список команд, которые необходимо выполнить на машине для установки раннера. Для того чтобы можно было запустить установку под рутованным профилем, перед исполнением всех команд добавляем в ENV системы параметр, разрешающий  делать все под рутом.

```shell
export RUNNER_ALLOW_RUNASROOT=1
```

Запускаем установку, пропуская этап запуска вручную.

![github runner installation](/static/img/runner-creation-second.png)

Чтобы нам не пришлось каждый раз запускать раннера руками, настроим его запуск as-a-service (благо Ubuntu нам это позволяет сделать).

В той же директории запускаем `.sh` скрипт для установки сервиса:
```shell
sudo ./svc.sh install
```
Запустим сервис:
```shell
sudo ./svc.sh start
```
Статус раннера можно узнать командой:
```shell
sudo ./svc.sh status
```

Теперь в Github Runners отображается наш только что созданный раннер.

![github runner idle](/static/img/runner-creation-final.png)

## Этап 2 - Формируем Workflow и запускаем его на раннере

Все пайплайны Github хранит по пути `/.github/workflows/`, каждый файл формата `.yml`.

Пайплайн `hello-world-example.yml` содержит базовый пример того, как выглядит Workflow. При запуске видим как в консоль выводятся сэмпл предложения.

![github action](/static/img/run-workflow-first.png)

В папке `example-project` лежит очень простой проект html-страницы, которую хочется запустить в Nginx в Docker-контейнере. На нем научимся составлять пайплайн.

В основные этапы сборки проекта входит:
- Сборка образа в Docker под названием `my-nginx` // `docker build . -t my-nginx`;
- Запуск проекта с учетом проброса 80 порта // `docker run -p 80:80 -d my-nginx`;

Напишем простой Workflow:
